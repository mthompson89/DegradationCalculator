comp_df <- AIC(zimod,mod)
diff <- abs(comp_df$AIC[1]-comp_df$AIC[2])
lower <- which.min(comp_df$AIC)
sppTemp <- data.frame(species = x,
bestMod = case_when(diff <= 2 ~ "No Difference",
lower == 1 ~ "Zero-inflated",
lower == 2 ~ "Normal Poisson"))
BestModBySpp <- rbind(BestModBySpp,sppTemp)
return(BestModBySpp)
},
error = function(e) {
# Return a placeholder row with "ZinoConv"
sppTemp <- data.frame(
species = x,
bestMod = "Zi (No Converge)"
)
BestModBySpp <- rbind(BestModBySpp, sppTemp)
return(BestModBySpp)
})
}) %>%
bind_rows()
library(gt)
ModComparison %>%
gt() %>%
tab_header(
title = "Model Comparison Table"
)
models_1 %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
models_1%>%
filter(contrast!="(Mid-age) / Mature") %>%
mutate(Treat = factor(case_when(contrast == "(Mid-age) / LSOG" ~ "Mid-aged Forests",
contrast == "Mature / LSOG" ~ "Mature Forests"),
levels = c(
"Mature Forests",
"Mid-aged Forests"
))) %>%
ggplot( aes(x = ratio, y = Treat, color = Treat)) +
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(
y = "Treatments",
x = "Multiplicative Difference in bird density (birds/km²)")+
facet_wrap(~species)+
scale_color_manual(
values = c(
"Mature Forests" = "#4DAF4A",
"Mid-aged Forests"    = "#377EB8"
),breaks = c("Mature Forests","Mid-aged Forests"))+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
#Model for Reservations
models_2 <- lapply(Res_spp, function(x){
formula <- as.formula(paste(x,"~ Res"))
mod <- glm(formula,family = poisson(link = "log"),  data = birdData_filtered)
emm <- emmeans(mod, ~ Res)
# LS vs. all others
comp <- pairs(emm, type = "response",reverse = T) %>%
summary(infer = TRUE)  # infer=TRUE gives CI
# Turn into data frame for ggplot
comp_df <- as.data.frame(comp) %>%
mutate(species = x)
return(comp_df)
})%>%
bind_rows() %>%
mutate(across(where(is.numeric),~ round(.x,2)))
models_2 %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
#Reduced the number of species here to remove those with very large error and make the
#plot more readable.
Res.plot.spp<- c("AMRE", "BCCH", "BHVI", "BTGW", "GCKI",
"NOPA", "OVEN", "RBNU", "REVI", "YBSA",
"BLBW", "BTBW", "SWTH")
#Plot effects
models_2%>%
filter(species %in% Res.plot.spp) %>%
ggplot(aes(x = ratio, y = species))+
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(
y = "Species",
x = "Multiplicative Difference in bird density (birds/km²) On Reservation")+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
models_3 <- lapply(Res_spp, function(x){
formula <- as.formula(paste(x," ~ Res*TreatGrouped"))
mod <- glm(formula, family = poisson(link = "log"), data = birdRes)
emm <- emmeans(mod, ~ TreatGrouped|Res)
# LS vs. all others
comp <- pairs(emm, type = "response",reverse = T) %>%
summary(infer = TRUE) # infer=TRUE gives CI
# Turn into data frame for ggplot
comp_df <- as.data.frame(comp) %>%
mutate(species = x)
return(comp_df)
})%>%
bind_rows() %>%
mutate(across(where(is.numeric),~ round(.x,2)))
models_3 %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
models_3%>%
filter(species %in% Res.plot.spp) %>%
mutate(Res = factor(case_when(Res == 1 ~ "Reservation (SEB or BS)",
Res == 0 ~ "Off Reservations"))) %>%
ggplot(aes(x = ratio, y = Res, color = Res)) +
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(y = "Reservation Property",
x = "Multiplicative Difference in bird density (birds/km²) between Mature and LSOG")+
facet_wrap(~species)+
scale_color_manual(
values = c(
"Reservation (SEB or BS)" = "#4DAF4A",
"Off Reservations"    = "#377EB8"
),breaks = c("Reservation (SEB or BS)","Off Reservations"))+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
TreeCoverLoss <- rast("D:/WildlifeSocietyData/TreeCoverLoss_RegionalArea.tif")
TreeCoverLoss <- as.factor(TreeCoverLoss)
TreeCoverLossAggrigate <- TreeCoverLoss
pointBuffers500m <- vect("Data/500mPointBuffer.shp")
pointBuffers1000m <- vect("Data/1000m_PointBuffer.shp")
plot_ids <- pointBuffers500m$point
PercentAreaLoss500m <-  sample_lsm(
landscape = TreeCoverLoss,
y = pointBuffers500m,
plot_id = plot_ids,
what = "lsm_c_pland") %>%
mutate(TreeCoverLossYear500  = case_when(class == 0 ~ "noloss_500m",
class == 1 ~  "2001_500m",
class == 2 ~  "2002_500m",
class == 3 ~  "2003_500m",
class == 4 ~  "2004_500m",
class == 5 ~  "2005_500m",
class == 6 ~  "2006_500m",
class == 7 ~  "2007_500m",
class == 8 ~  "2008_500m",
class == 9 ~  "2009_500m",
class == 10 ~ "2010_500m",
class == 11 ~ "2011_500m",
class == 12 ~ "2012_500m",
class == 13 ~ "2013_500m",
class == 14 ~ "2014_500m",
class == 15 ~ "2015_500m",
class == 16 ~ "2016_500m",
class == 17 ~ "2017_500m",
class == 18 ~ "2018_500m",
class == 19 ~ "2019_500m",
class == 20 ~ "2020_500m",
class == 21 ~ "2021_500m",
class == 22 ~ "2022_500m"),
Loss500m = ifelse(class > 0,"treeloss_500m","NoLoss_500m")) %>%
rename("value500mTreeLoss"="value") %>%
select(plot_id,TreeCoverLossYear500,value500mTreeLoss,Loss500m)%>%
group_by(plot_id,Loss500m) %>%
summarise(PercentTreeloss500m = sum(value500mTreeLoss),
meanTreeloss500m = mean(value500mTreeLoss)) %>%
ungroup() %>%
complete(plot_id, Loss500m = c("treeloss_500m","NoLoss_500m"),fill = list(PercentTreeloss500m = 0,
meanTreeloss500m = 0)) %>%
filter(grepl("treeloss",Loss500m))
#1000m Buffers
PercentAreaLoss1000m <-  sample_lsm(
landscape = TreeCoverLoss,
y = pointBuffers1000m,
plot_id = plot_ids,
what = "lsm_c_pland") %>%
mutate(TreeCoverLossYear1000  = case_when(class == 0 ~  "noloss_1000m",
class == 1 ~  "2001_1000m",
class == 2 ~  "2002_1000m",
class == 3 ~  "2003_1000m",
class == 4 ~  "2004_1000m",
class == 5 ~  "2005_1000m",
class == 6 ~  "2006_1000m",
class == 7 ~  "2007_1000m",
class == 8 ~  "2008_1000m",
class == 9 ~  "2009_1000m",
class == 10 ~ "2010_1000m",
class == 11 ~ "2011_1000m",
class == 12 ~ "2012_1000m",
class == 13 ~ "2013_1000m",
class == 14 ~ "2014_1000m",
class == 15 ~ "2015_1000m",
class == 16 ~ "2016_1000m",
class == 17 ~ "2017_1000m",
class == 18 ~ "2018_1000m",
class == 19 ~ "2019_1000m",
class == 20 ~ "2020_1000m",
class == 21 ~ "2021_1000m",
class == 22 ~ "2022_1000m"),
Loss1000m = ifelse(class > 0,"treeloss_1000m","NoLoss_1000m")) %>%
rename("value1000mTreeLoss"="value") %>%
select(plot_id,TreeCoverLossYear1000,value1000mTreeLoss,Loss1000m) %>%
group_by(plot_id,Loss1000m) %>%
summarise(PercentTreeloss1000m = sum(value1000mTreeLoss),
meanTreeloss1000m = mean(value1000mTreeLoss))  %>%
ungroup() %>%
complete(plot_id, Loss1000m = c("treeloss_1000m","NoLoss_1000m"),fill = list(PercentTreeloss1000m = 0,
meanTreeloss1000m = 0)) %>%
filter(grepl("treeloss",Loss1000m))
ResData_percLoss <- birdData_filtered %>%
select(point,Res) %>%
left_join(PercentAreaLoss500m, by = join_by("point"=="plot_id")) %>%
left_join(PercentAreaLoss1000m, by = join_by("point"=="plot_id"))
#percent tree cover loss 500m
ResData_percLoss %>%
ggplot(aes(x = as.factor(Res), y = PercentTreeloss500m, fill = as.factor(Res)))+
geom_boxplot()
#percent tree cover loss 1000m
ResData_percLoss %>%
ggplot(aes(x = as.factor(Res), y = PercentTreeloss1000m, fill = as.factor(Res)))+
geom_boxplot()
x.sum <- ResData_percLoss %>%
filter(grepl("treeloss",Loss500m),
grepl("treeloss",Loss1000m)) %>%
select(point,PercentTreeloss500m,PercentTreeloss1000m) %>%
column_to_rownames("point")
cl.sum <- kmeans(x.sum ,centers = 4)
fviz_cluster(cl.sum,x.sum)
#joining the clusters to the percent loss layer from earlier
clusterGroups <- as.data.frame(cl.sum$cluster) %>%
rownames_to_column("point") %>%
rename("clusters"="cl.sum$cluster") %>%
mutate(clusters = as.factor(clusters)) %>%
left_join(ResData_percLoss)
#joining the clusters to the bird data from earlier
birdData_filtered.cl <- birdData_filtered %>%
left_join(clusterGroups) %>%
mutate(ModRes = ifelse(clusters == "2","Res"," NoRes"))
# releveling the cluster groups to make cluster 2 (low disturbance) the reference.
birdData_filtered.cl <- within(birdData_filtered.cl,clusters <- relevel(clusters,ref = "2"))
birdData_filtered.cl <- birdData_filtered.cl %>%
mutate(Disturbance = factor(case_when(clusters == "2" ~ "low disturbance",
clusters == "1" ~ "mild disturbance",
clusters == "3" ~ "moderate disturbance",
clusters == "4" ~ "high disturbance"),
ordered = T,
levels = c("low disturbance","mild disturbance","moderate disturbance","high disturbance")))
models_4 <- lapply(Res_spp, function(x){
formula <- as.formula(paste(x,"~ Disturbance"))
mod <- glm(formula,family = poisson(link = "log"),  data = birdData_filtered.cl)
emm <- emmeans(mod, ~ Disturbance)
# LS vs. all others
comp <- pairs(emm, type = "response",reverse = T) %>%
summary(infer = TRUE)  # infer=TRUE gives CI
# Turn into data frame for ggplot
comp_df <- as.data.frame(comp) %>%
mutate(species = x)
return(comp_df)
})%>%
bind_rows()
models_4 %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
View(models_4)
#joining the clusters to the percent loss layer from earlier
clusterGroups <- as.data.frame(cl.sum$cluster) %>%
rownames_to_column("point") %>%
rename("clusters"="cl.sum$cluster") %>%
mutate(clusters = as.factor(clusters)) %>%
left_join(ResData_percLoss)
#joining the clusters to the bird data from earlier
birdData_filtered.cl <- birdData_filtered %>%
left_join(clusterGroups) %>%
mutate(ModRes = ifelse(clusters == "2","Res"," NoRes"))
# releveling the cluster groups to make cluster 2 (low disturbance) the reference.
birdData_filtered.cl <- within(birdData_filtered.cl,clusters <- relevel(clusters,ref = "2"))
birdData_filtered.cl <- birdData_filtered.cl %>%
mutate(Disturbance = factor(case_when(clusters == "2" ~ "low disturbance",
clusters == "1" ~ "mild disturbance",
clusters == "3" ~ "moderate disturbance",
clusters == "4" ~ "high disturbance"),
ordered = T,
levels = c("low disturbance","mild disturbance","moderate disturbance","high disturbance")))
models_4 <- lapply(Res_spp, function(x){
formula <- as.formula(paste(x,"~ Disturbance"))
mod <- glm(formula,family = poisson(link = "log"),  data = birdData_filtered.cl)
emm <- emmeans(mod, ~ Disturbance)
# LS vs. all others
comp <- pairs(emm, type = "response",reverse = T) %>%
summary(infer = TRUE)  # infer=TRUE gives CI
# Turn into data frame for ggplot
comp_df <- as.data.frame(comp) %>%
mutate(species = x)
return(comp_df)
})%>%
bind_rows() %>%
mutate(across(where(is.numeric),round, 3))
models_4 %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
models_4%>%
filter(contrast %in% c("mild disturbance / low disturbance",
"moderate disturbance / low disturbance",
"high disturbance / low disturbance")) %>%
filter(species %in% Target_spp[!Target_spp %in% c("PUFI","YBFL","BRCR")]) %>%
mutate(Treat = factor(case_when(contrast == "mild disturbance / low disturbance" ~ "Mild Disturbance",
contrast == "moderate disturbance / low disturbance" ~ "Moderate Disturbance",
contrast == "high disturbance / low disturbance" ~ "Heavy disturbance"),
levels = c(
"Mild Disturbance",
"Moderate Disturbance",
"Heavy disturbance"
))) %>%
ggplot( aes(x = ratio, y = Treat, color = Treat)) +
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(
y = "Disturbance",
x = "Multiplicative Difference in bird density (birds/km²)")+
facet_wrap(~species)+
scale_color_manual(
values = c(
"Mild Disturbance" = "#4DAF4A",
"Moderate Disturbance"    = "#377EB8",
"Heavy disturbance"    = "#aa4595"
),breaks = c("Mild Disturbance","Moderate Disturbance","Heavy disturbance"))+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
models_4 %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
models_4 %>%
filter(contrast %in% c("mild disturbance / low disturbance",
"moderate disturbance / low disturbance",
"high disturbance / low disturbance")) %>%
gt() %>%
tab_header(
title = "Poisson Model Results"
)
models_4%>%
filter(contrast %in% c("mild disturbance / low disturbance",
"moderate disturbance / low disturbance",
"high disturbance / low disturbance")) %>%
#removing these species to help make the plot more readable.
filter(species %in% Target_spp[!Target_spp %in% c("PUFI","YBFL","BRCR","RTHU")]) %>%
mutate(Treat = factor(case_when(contrast == "mild disturbance / low disturbance" ~ "Mild Disturbance",
contrast == "moderate disturbance / low disturbance" ~ "Moderate Disturbance",
contrast == "high disturbance / low disturbance" ~ "Heavy disturbance"),
levels = c(
"Mild Disturbance",
"Moderate Disturbance",
"Heavy disturbance"
))) %>%
ggplot( aes(x = ratio, y = Treat, color = Treat)) +
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(
y = "Disturbance",
x = "Multiplicative Difference in bird density (birds/km²)")+
facet_wrap(~species)+
scale_color_manual(
values = c(
"Mild Disturbance" = "#4DAF4A",
"Moderate Disturbance"    = "#377EB8",
"Heavy disturbance"    = "#aa4595"
),breaks = c("Mild Disturbance","Moderate Disturbance","Heavy disturbance"))+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
models_4%>%
filter(contrast %in% c("mild disturbance / low disturbance",
"moderate disturbance / low disturbance",
"high disturbance / low disturbance")) %>%
#removing these species to help make the plot more readable.
filter(species %in% Target_spp[!Target_spp %in% c("PUFI","YBFL","BRCR","RTHU")]) %>%
mutate(Treat = factor(case_when(contrast == "mild disturbance / low disturbance" ~ "Mild Disturbance",
contrast == "moderate disturbance / low disturbance" ~ "Moderate Disturbance",
contrast == "high disturbance / low disturbance" ~ "Heavy disturbance"),
levels = c(
"Mild Disturbance",
"Moderate Disturbance",
"Heavy disturbance"
))) %>%
ggplot( aes(x = ratio, y = Treat, color = Treat)) +
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(
y = "Disturbance",
x = "Multiplicative Difference in bird density (birds/km²)")+
facet_wrap(~species)+
scale_color_manual(
values = c(
"Mild Disturbance" = "#4DAF4A",
"Moderate Disturbance"    = "#377EB8",
"Heavy disturbance"    = "#aa4595"
),breaks = c("Mild Disturbance","Moderate Disturbance","Heavy disturbance"))+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
models_4%>%
filter(contrast %in% c("mild disturbance / low disturbance",
"moderate disturbance / low disturbance",
"high disturbance / low disturbance")) %>%
#removing these species to help make the plot more readable.
filter(species %in% Target_spp[!Target_spp %in% c("PUFI","YBFL","BRCR","RTHU")]) %>%
mutate(Treat = factor(case_when(contrast == "mild disturbance / low disturbance" ~ "Mild Disturbance",
contrast == "moderate disturbance / low disturbance" ~ "Moderate Disturbance",
contrast == "high disturbance / low disturbance" ~ "Heavy disturbance"),
levels = c(
"Mild Disturbance",
"Moderate Disturbance",
"Heavy disturbance"
))) %>%
ggplot( aes(x = ratio, y = Treat, color = Treat)) +
geom_point(size = 3) +
geom_errorbar(aes(xmin = asymp.LCL, xmax = asymp.UCL),
width = 0.2) +
geom_vline(xintercept = 1, linetype = "dashed") +
labs(
y = "Disturbance",
x = "Multiplicative Difference in bird density (birds/km²)")+
facet_wrap(~species)+
scale_color_manual(
values = c(
"Mild Disturbance" = "#4DAF4A",
"Moderate Disturbance"    = "#377EB8",
"Heavy disturbance"    = "#aa4595"
),breaks = c("Mild Disturbance","Moderate Disturbance","Heavy disturbance"))+
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 15),
axis.text.x = element_text(angle = 90,vjust = 0.5,hjust = 1))
tinytex::install_tinytex()
shiny::runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
shiny::runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
shiny::runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
runApp('C:/Users/mthom/Work/DegradationCalculator')
setwd("~/")
setwd("C:/Users/mthom/Work/DegradationCalculator")
sgref <- read.csv("SG_ref.csv")
str(sgref)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
